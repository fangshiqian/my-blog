---
title: 移动端项目(类似今日头条)
date: 2019-11-30 20:33:18
top:
categories: 学习
tags: 移动端项目
---

## ☆☆  项目初始化

### 1. 使用`Vue cli`初始化项目

在命令行中输入一下命令创建项目

```bash
vue create zuoritoutiao-mobile
```

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asdjkq23)

> ​	default：默认勾选 babel、eslint，回车之后直接进入装包
>
> manually：自定义勾选特性配置，选择完毕之后，才会进入装包
>
> 选择第2种：手动选择特性，支持更多自定义选项

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/d31w3q)

> ​	分别选择：
>
> Babel：es6 转 es5
>
> Router：路由
>
> Vuex：容器
>
> CSS Pre-processors：CSS预处理器
>
> Linter / Formatter：代码格式校验

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/dqw1eq32we)

> ​	是否使用 history 路由模式，这里输入 n 不使用

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asd123wq)

> ​	选择 CSS 预处理器，这里选择 Less

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/dqw2e1q3we)

> 选择校验工具，这里选择 ESLint + [Standard config](https://standardjs.com/)

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asdqwe213q)

> 选择在什么时机下触发代码格式校验：
>
> - Lint on save：每当保存文件的时候
> - Lint and fix on commit：每当执行 `git commit` 提交的时候
>
> 这里建议两个都选上，更严谨。

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asdq1w1e)

> Babel、ESLint 等工具会有一些额外的配置文件，这里的意思是问你将这些工具相关的配置文件写到哪里：
>
> - In dedicated config files：分别保存到单独的配置文件
> - In package.json：保存到 package.json 文件中
>
> 这里讲义选择第1个，保存到单独的配置文件，这样方便我们做自定义配置。

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asdqw321e)

> 这里是问你是否需要将刚才选择的一系列配置保存起来，然后它可以帮你记住上面的一系列选择，以便下次直接重用。
>
> 这里根据自己需要输入 y 或者 n，我这里输入 n 不需要

> ​	安装结束，命令提示你项目创建成功，按照命令行的提示在终端中分别输入：
>
> - `cd 你的项目`
> - `npm run serve`

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/sdq3as4d)

### 2. 目录结构

```bash
├── babel.config.js    babel配置文件
├── package-lock.json    npm相关文件
├── package.json    npm相关文件
├── postcss.config.js    postcss配置文件
├── public    静态资源托管目录
│   ├── favicon.ico
│   └── index.html
├── README.md    项目说明文件
└── src    源码
    ├── App.vue    根组件
    ├── assets    资源目录
    ├── components    组件目录
    ├── main.js    入口文件
    ├── router.js    路由模块
    ├── store.js    vuex容器模块
    └── views  视图组件目录
```

### 3. 加入 Git 版本管理

```bash
略
```

### 4. 调整目录结构

> 默认生成的目录结构不满足我们的开发需求，所以这里需要做一些自定义改动。
>
> 这里主要就是下面的两个工作：

```bash
├── babel.config.js    babel配置文件
├── package-lock.json    npm相关文件
├── package.json    npm相关文件
├── postcss.config.js    postcss配置文件
├── public    静态资源托管目录
│   ├── favicon.ico
│   └── index.html
├── README.md    项目说明文件
└── src    源码
    ├── api    请求接口封装模块
    ├── App.vue    根组件
    ├── assets    资源目录
    ├── components    组件目录
    ├── main.js    入口文件
    ├── router    路由模块
    ├── store     Vuex容器模块
    ├── styles 样式目录
    ├── utils  工具模块目录
    └── views  视图组件目录
```

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/ZXC132WD)

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/asdq3w21e)

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/zq12w3dq)

![](https://raw.githubusercontent.com/fangshiqian/mtup/master/mtup/zxsdq13)

提交一次git远程仓库 项目初始化

### 5. 导入 Vant

> ​	参考：
>
> - https://youzan.github.io/vant/#/zh-CN/quickstart

> 封装注册使用: 
>
> ​		在 `main.js` 中写一堆注册组件的代码不利于阅读和维护，建议将注册 Vant 组件的代码单独封装到一个独立的模块中。

1.  创建 `utils/register-vant.js`

   ```bash
   import Vue from 'vue'
   
   import {
     Button,
     Cell,
     CellGroup
   } from 'vant'
   
   Vue
     .use(Button)
     .use(Cell)
     .use(CellGroup)
   ```

2.  在 `main.js` 中加载执行注册模块

```bash
	import './utils/register-vant.js'
```

​	之后所有 Vant 组件的注册就都写到上面的模块中，而组件的使用该怎么使用还是怎么使用。

### 6. 配置 REM 适配

Vant 中的样式默认使用`px`作为单位，如果需要使用`rem`单位，推荐使用以下两个工具：

- [postcss-pxtorem](https://github.com/cuth/postcss-pxtorem) 是一款 postcss 插件，用于将单位转化为 rem
- [lib-flexible](https://github.com/amfe/lib-flexible) 用于设置 rem 基准值

1. 使用 [postcss-pxtorem](https://github.com/cuth/postcss-pxtorem) 将 px 转为 rem

   ```bash
   npm install postcss-pxtorem -D
   ```

   

2. 然后在项目根目录中创建 `postcss.config.js` 文件

   ```bash
   module.exports = {
     plugins: {
       'postcss-pxtorem': {
         rootValue: 37.5,
         propList: ['*']
       }
     }
   }
   ```

3. 重新启动服务

4. 使用 [amfe-flexible](https://github.com/amfe/lib-flexible) 动态设置 REM基准值

   ```bash
   npm i amfe-flexible
   ```

   ```bash
   然后在 `main.js` 中加载执行该模块
   import 'amfe-flexible'
   ```

### 7. 配置封装 axios 请求函数

这里我们直接把 axios 封装为一个请求模块，在需要的时候直接加载使用。

1. 安装 axios

   ```bash
   npm i axios
   ```

2. 创建 `src/utils/request.js`

   ```js
   /**
    * 封装 axios 请求模块
    */
   import axios from 'axios'
   
   // axios.create 方法：复制一个 axios
   const request = axios.create({
     baseURL: 'http://ttapi.research.itcast.cn/' // 基础路径
   })
   
   // 请求拦截器
   request.interceptors.request.use(
     function(config) {
       // Do something before request is sent
       return config
     },
     function(error) {
       // Do something with request error
       return Promise.reject(error)
     }
   )
   
   // 响应拦截器
   request.interceptors.response.use(
     function(response) {
       // Any status code that lie within the range of 2xx cause this function to trigger
       // Do something with response data
       return response
     },
     function(error) {
       // Any status codes that falls outside the range of 2xx cause this function to trigger
       // Do something with response error
       return Promise.reject(error)
     }
   )
   
   export default request
   
   ```

3. 如何使用

   - 方式一：我们可以把 request 挂载到 Vue.prototype 原型对象中，然后在组件中通过 this 直接访问
     - 简单粗暴
   - 方式二：我们把每一个请求都封装成一个一个的独立功能函数，在需要的时候加载调用即可

   该项目中我们会采用方式二，更推荐。

### 8. 处理后端返回数据超出 JS 安全整数范围问题

该项目所使用的后端接口数据中包含超出 JavaScript 安全整数范围的数字，所以也需要像之前的 PC 端项目一样使用 [json-bigint](https://github.com/sidorares/json-bigint) 将后端返回数据处理一下才能正确使用。

1. 安装依赖

   ```bash
   npm i json-bigint
   ```

2. 在 `utils/request.js`

   ```js
   /**
    * 封装 axios 请求模块
    */
   import axios from 'axios'
   + import jsonBig from 'json-bigint'
   
   // axios.create 方法：复制一个 axios
   const request = axios.create({
     baseURL: 'http://ttapi.research.itcast.cn/' // 基础路径
   })
   
   /**
    * 配置处理后端返回数据中超出 js 安全整数范围问题
    */
   + request.defaults.transformResponse = [function (data) {
   +  try {
   +    return jsonBig.parse(data)
   +  } catch (err) {
   +    return {}
   +  }
   + }]
   
   // 请求拦截器
   request.interceptors.request.use(
     function (config) {
       // Do something before request is sent
       return config
     },
     function (error) {
       // Do something with request error
       return Promise.reject(error)
     }
   )
   
   // 响应拦截器
   request.interceptors.response.use(
     function (response) {
       // Any status code that lie within the range of 2xx cause this function to trigger
       // Do something with response data
       return response
     },
     function (error) {
       // Any status codes that falls outside the range of 2xx cause this function to trigger
       // Do something with response error
       return Promise.reject(error)
     }
   )
   
   export default request
   ```

   